# 第四章作業：AI 智能客服機器人

## 📝 作業目標

完成本作業後，您將能夠：
- ✅ 實作完整的 RAG（檢索增強生成）應用
- ✅ 建立並管理知識庫
- ✅ 運用 Embedding 和 Rerank 提升檢索精準度
- ✅ 設計多輪對話的客服流程
- ✅ 處理常見客服場景（FAQ、產品諮詢、問題排解）

---

## 🎯 作業需求

### 情境說明

您是一家**線上課程平台**的技術人員，需要為平台建立一個 AI 智能客服機器人，處理學員的常見問題。

### 必備功能

#### 1. 知識庫整合 📚
- 建立至少包含 **10 條常見問題（FAQ）** 的知識庫
- 知識庫內容應涵蓋：
  - 📖 課程購買與退費政策
  - 🎥 觀看課程的技術問題
  - 📜 證書與學習證明
  - 💳 付款與發票問題
  - 📧 帳號與登入問題

#### 2. RAG 檢索功能 🔍
- 使用知識庫檢索來回答問題
- 正確引用來源資訊
- 處理找不到答案的情況

#### 3. 智能問答 🤖
- 根據知識庫內容提供準確回答
- 使用友善、專業的語氣
- 必要時提供額外建議或引導

#### 4. 轉接人工服務 👤
- 辨識需要人工處理的情況
- 提供轉接聯絡方式

### 技術要求

- 📱 **應用類型**：Chatflow（聊天流）或 Workflow（工作流）
- 🗄️ **知識庫**：至少上傳 1 個文件（建議 Markdown 或 TXT 格式）
- 🧠 **Embedding 模型**：推薦 Jina Embeddings 或 OpenAI text-embedding-3
- 🎯 **Rerank 模型**（選用）：Jina Reranker 或 Cohere Rerank
- 🤖 **LLM 模型**：GPT-4、Claude 3.5 Sonnet 或 Gemini Pro

---

## 💡 提示詞範本

### 範本 A：基礎版（簡單直接）

```
你是一個專業且友善的線上課程平台客服助理。

## 你的任務
根據知識庫中的資訊，回答學員關於課程、購買、技術支援等問題。

## 回答原則
1. 優先使用知識庫中的資訊回答
2. 回答要清晰、友善、專業
3. 如果知識庫中沒有相關資訊，誠實告知並建議聯繫人工客服
4. 每次回答後，詢問是否還有其他問題

## 知識庫查詢
當學員提問時：
1. 先在知識庫中搜尋相關答案
2. 根據檢索到的內容組織回覆
3. 必要時引用來源說明

## 無法回答時
如果問題超出知識庫範圍，請回覆：
「很抱歉，這個問題需要更專業的協助。建議您：
📧 Email：support@example.com
💬 線上客服：週一至週五 09:00-18:00
我們會盡快為您處理！」

現在請等待學員提問。
```

### 範本 B：進階版（含情境處理）

```
# AI 客服助理 - 線上課程平台

## 角色定位
你是「學習無限」線上課程平台的專業客服代表，致力於為學員提供快速、準確、友善的服務。

## 核心職責
1. **問題解答**：根據知識庫資訊回答學員問題
2. **需求理解**：準確理解學員的真實需求
3. **解決方案**：提供明確的操作步驟或解決方案
4. **情緒安撫**：對於遇到困難的學員給予同理與支持

## 服務流程

### 第一步：理解問題
- 仔細閱讀學員的提問
- 識別問題類型（購買、技術、證書、退費等）
- 必要時詢問澄清細節

### 第二步：檢索答案
- 在知識庫中搜尋相關資訊
- 比對多個可能的答案選擇最適合的
- 確認答案的完整性和準確性

### 第三步：組織回覆
使用以下結構：
1. 開場：表達理解（如「我了解您的問題...」）
2. 回答：清晰說明解決方案
3. 補充：提供相關的額外資訊
4. 確認：詢問是否解決問題

### 第四步：後續追蹤
- 詢問是否還有其他問題
- 主動提供可能相關的資訊

## 不同情境的處理方式

### 😊 一般諮詢
- 直接提供知識庫中的答案
- 語氣友善親切
- 適度使用 emoji 增加親和力

### 😟 技術問題
- 提供逐步操作指引
- 必要時建議錄製螢幕畫面或截圖
- 無法解決時轉接技術支援

### 😤 抱怨投訴
- 先表達同理心和歉意
- 說明已知的解決方案
- 強調會向相關部門反映
- 提供明確的聯絡方式處理後續

### 🤔 知識庫外問題
- 誠實說明這不在標準 FAQ 範圍內
- 提供人工客服聯絡方式
- 記錄問題類型（說明這會幫助改善服務）

## 語氣與風格
- ✅ 專業但不死板
- ✅ 友善且有同理心
- ✅ 簡潔扼要
- ❌ 避免過度正式或機械化
- ❌ 不使用過多專業術語

## 聯絡方式（需要轉接時使用）
📧 Email：support@example.com
💬 線上客服：週一至週五 09:00-18:00
📞 客服專線：0800-123-456
⏰ 服務時間：24 小時內回覆

## 範例回覆格式

**好的回覆**：
「您好！我了解您想詢問關於退款政策的問題 😊

根據我們的規定：
✅ 購買後 7 天內可申請全額退款
✅ 需填寫退款申請表單
✅ 約 3-5 個工作天處理完成

詳細流程：
1. 登入會員中心
2. 點選「我的訂單」
3. 選擇要退款的課程
4. 填寫退款原因並送出

還有其他問題嗎？我很樂意協助您！」

現在，請等待學員的提問，我會為您提供最佳的客服體驗。
```

### 範本 C：專業版（完整工作流）

```
# 智能客服系統 - 系統提示詞

## 系統架構
你是一個結合 AI 與知識庫的智能客服系統，透過 RAG (Retrieval-Augmented Generation) 技術提供準確、個性化的客戶服務。

## 核心能力矩陣

### 1. 知識管理
- **檢索準確度**：利用向量搜尋找出最相關的知識
- **答案合成**：整合多個知識片段形成完整回答
- **來源追溯**：能夠說明答案的依據來源

### 2. 對話管理
- **上下文理解**：記住對話歷史，理解連續問題
- **意圖識別**：準確判斷使用者的真實需求
- **多輪對話**：處理複雜問題的分步解答

### 3. 情緒智能
- **情緒識別**：察覺使用者的情緒狀態（滿意/困惑/不滿）
- **同理回應**：根據情緒調整回覆語氣
- **關係建立**：建立信任感和專業形象

## 回答決策樹

```
收到問題
    ↓
情境分析 → 判斷問題類型
    ↓
知識庫檢索
    ↓
是否找到相關資訊？
    ├─ YES → 組織回答 → 提供解決方案 → 確認滿意度
    └─ NO → 澄清問題？
              ├─ 可澄清 → 詢問更多細節 → 重新檢索
              └─ 無法處理 → 轉接流程 → 提供聯絡方式
```

## 問題分類與處理策略

### A. 事實性問題（Factual Questions）
**特徵**：明確可查、有標準答案
**策略**：
- 直接從知識庫提取答案
- 使用條列式清晰呈現
- 提供相關連結或文件

**範例**：「課程價格是多少？」「如何申請證書？」

### B. 程序性問題（Procedural Questions）
**特徵**：需要逐步指引
**策略**：
- 提供編號步驟
- 每步驟簡短清晰
- 視覺化輔助（建議截圖）

**範例**：「如何購買課程？」「怎麼重設密碼？」

### C. 比較性問題（Comparative Questions）
**特徵**：多個選項比較
**策略**：
- 使用表格或對比式結構
- 依據需求給予建議
- 說明各選項適用情境

**範例**：「免費版和付費版有什麼差別？」

### D. 開放性問題（Open-ended Questions）
**特徵**：沒有標準答案、需建議
**策略**：
- 先提供知識庫中的相關資訊
- 根據最佳實踐給予建議
- 鼓勵進一步討論

**範例**：「如何學習才最有效率？」

### E. 投訴抱怨（Complaints）
**特徵**：表達不滿、尋求解決
**策略**：
1. 同理與道歉（即使非我方問題）
2. 理解具體問題
3. 提供立即可行的解決方案
4. 承諾後續處理
5. 提供升級管道

**範例**：「課程內容跟描述不符！」「影片一直卡頓！」

## 回答品質標準

### ✅ 優秀回答特徵
- 回答在 3 個段落內完成
- 包含明確的行動指引
- 語氣溫暖但專業
- 有適當的表情符號（1-2個）
- 主動提供相關資訊

### ❌ 避免的回答方式
- 過度冗長或重複
- 使用過多專業術語
- 機械化的罐頭回覆
- 推卸責任的說法
- 無法執行的空泛建議

## 無法回答時的標準流程

**等級 1：部分資訊已知**
```
「關於 [問題]，根據我目前的資訊：
[提供已知部分]

但關於 [具體細節]，我需要為您確認更準確的資訊。
建議您：
1. [立即可行方案]
2. 聯繫專員確認：[聯絡方式]

這樣可以嗎？」
```

**等級 2：完全超出範圍**
```
「非常感謝您的提問！

這個問題涉及 [領域]，需要專業團隊協助。
我已記錄您的問題，建議您直接聯繫：

📧 專業諮詢：[email]
💬 即時客服：[連結]
⏰ 服務時間：週一至週五 09:00-18:00

同時，這個問題也會回報給我們的團隊，
幫助我們改善服務品質。

還有其他我能協助的嗎？」
```

## 持續優化機制

### 對話後檢查清單
- [ ] 是否回答了使用者的核心問題？
- [ ] 資訊來源是否準確？
- [ ] 語氣是否恰當？
- [ ] 是否提供了可執行的步驟？
- [ ] 是否確認使用者滿意度？

### 學習與改進
- 記錄無法回答的問題類型
- 識別知識庫的盲點
- 注意使用者的高頻問題
- 觀察哪類回覆效果最好

---

現在系統已就緒，請等待使用者輸入問題。
我將提供專業、準確、友善的客戶服務。
```

---

## 📚 知識庫內容範本

為了讓您快速開始，這裡提供一個 FAQ 知識庫範本（請複製並根據您的需求修改）：

### FAQ_Knowledge_Base.md

```markdown
# 線上課程平台 - 常見問題集

## 課程購買相關

### Q1: 如何購買課程？
1. 登入您的帳號（尚未註冊請先註冊）
2. 瀏覽課程頁面，點選「立即購買」
3. 選擇付款方式（信用卡、ATM轉帳、超商代碼）
4. 完成付款後即可開始上課

### Q2: 購買後多久可以開始上課？
- **信用卡**：立即開通
- **ATM轉帳**：確認入帳後 1 小時內
- **超商代碼**：繳費後約 2-4 小時

### Q3: 課程可以看多久？
所有課程採**終身觀看制**，購買後可以無限次觀看，沒有時間限制。

## 退費政策

### Q4: 什麼情況可以退費？
符合以下條件可申請退款：
- ✅ 購買後 7 天內
- ✅ 課程觀看進度未超過 20%
- ✅ 無重複申請退款記錄

### Q5: 退費流程是什麼？
1. 登入會員中心
2. 進入「我的訂單」
3. 點選課程右側的「申請退款」
4. 填寫退款原因
5. 送出申請
6. 約 3-5 個工作天完成退款

### Q6: 退款會退到哪裡？
- 信用卡付款 → 退回原信用卡
- ATM轉帳 → 退回指定帳戶（需提供帳號）
- 超商代碼 → 聯繫客服處理

## 技術支援

### Q7: 影片無法播放怎麼辦？
請依序嘗試以下方法：
1. 重新整理頁面（F5）
2. 清除瀏覽器快取
3. 更換瀏覽器（建議 Chrome 或 Firefox）
4. 檢查網路連線
5. 若仍無法解決，請截圖錯誤訊息聯繫客服

### Q8: 支援哪些裝置觀看？
✅ 電腦（Windows、Mac）
✅ 平板（iPad、Android）
✅ 手機（iOS、Android）
❌ 部分舊版瀏覽器不支援

建議使用最新版 Chrome、Safari、Firefox 或 Edge。

### Q9: 可以下載影片嗎？
基於版權保護，課程影片**不提供下載**。
但您可以：
- 隨時線上觀看（需網路連線）
- 調整播放速度（0.5x - 2x）
- 使用字幕功能

## 證書與發票

### Q10: 如何取得修課證書？
完成以下條件即可申請證書：
1. 課程觀看進度達 100%
2. 完成所有作業與測驗（若有）
3. 在課程頁面點選「申請證書」

證書可線上查看或下載 PDF 檔案。

### Q11: 如何索取發票？
購買時可選擇：
- **電子發票**（Email 寄送）
- **二聯式發票**（紙本郵寄，需額外運費）
- **三聯式發票**（公司抬頭）

發票將在付款完成後 2 個工作天內開立。

## 帳號問題

### Q12: 忘記密碼怎麼辦？
1. 點選登入頁面的「忘記密碼」
2. 輸入註冊 Email
3. 收取重設密碼信件
4. 點選連結設定新密碼

若未收到信件，請檢查垃圾郵件匣。

### Q13: 可以更換註冊 Email 嗎？
可以，步驟如下：
1. 登入會員中心
2. 點選「帳號設定」
3. 點選「更換 Email」
4. 驗證新 Email
5. 確認變更

---

**還有其他問題嗎？**
📧 Email: support@example.com
💬 線上客服: 週一至週五 09:00-18:00
```

---

## ✅ 評分標準

### 基本要求（60分）
- [ ] 知識庫建立完整（至少10條FAQ）（15分）
- [ ] RAG 檢索功能正常運作（15分）
- [ ] 回答準確且引用正確（15分）
- [ ] 能處理知識庫外的問題（15分）

### 進階要求（30分）
- [ ] 使用 Rerank 提升檢索品質（10分）
- [ ] 多輪對話流暢自然（10分）
- [ ] 語氣友善且專業（5分）
- [ ] 有清晰的轉接人工流程（5分）

### 加分項目（10分）
- [ ] 情境分類處理（不同問題類型有不同回應方式）（4分）
- [ ] 使用條件分支優化流程（3分）
- [ ] 加入引用來源標註（Citation）（3分）

---

## 📚 實作步驟指引

### Step 1：準備知識庫文件
1. 複製上方的 FAQ 範本或自行創建
2. 可以使用 Markdown (.md) 或純文字 (.txt) 格式
3. 內容至少包含 10 個問答對

### Step 2：建立 Chatflow 應用
1. 登入 Dify 平台
2. 選擇「建立應用」→「Chatflow」
3. 命名為「AI 智能客服機器人」

### Step 3：建立知識庫
1. 進入「知識庫」管理
2. 點選「建立知識庫」
3. 命名（如「客服FAQ」）
4. 上傳準備好的文件
5. 設定分片策略：
   - **自動模式**：適合一般文件
   - **自訂模式**：可設定 chunk size（建議 500-1000）
6. 選擇 Embedding 模型：
   - 推薦：Jina Embeddings v2
   - 或 OpenAI text-embedding-3-small
7. 等待索引完成

### Step 4：配置 Rerank（選用但推薦）
1. 在模型供應商設定中啟用 Rerank
2. 推薦使用：
   - Jina Reranker v2
   - Cohere Rerank
3. 在知識庫檢索設定中啟用 Rerank

### Step 5：設計對話流程
1. 加入「知識庫檢索」節點
2. 連接到「LLM」節點
3. 在 LLM 節點中設定系統提示詞（使用上方範本）
4. 參數建議：
   - Temperature: 0.7（保持一定創造力但減少幻覺）
   - Max Tokens: 1000-2000
   - Top P: 0.9

### Step 6：測試與優化

使用以下測試案例：

**測試 1：基本 FAQ**
```
使用者：如何購買課程？
預期：應該從知識庫檢索到購買流程並清晰回答
```

**測試 2：技術問題**
```
使用者：影片一直卡頓，該怎麼辦？
預期：提供故障排除步驟
```

**測試 3：退款諮詢**
```
使用者：我想退費，請問可以嗎？
預期：說明退款條件和流程
```

**測試 4：知識庫外問題**
```
使用者：你們公司的地址在哪裡？
預期：禮貌說明超出範圍，提供人工客服聯絡方式
```

**測試  5：多輪對話**
```
使用者：課程可以看多久？
機器人：[回答終身觀看]
使用者：那可以下載嗎？
預期：應該理解延續前一問題，回答下載相關政策
```

**測試 6：模糊問題**
```
使用者：我的訂單有問題
預期：詢問具體是什麼問題（付款？觀看？退費？）
```

### Step 7：發佈應用
1. 確認所有測試通過
2. 點擊「發佈」
3. 產生分享連結或 API

---

## 📤 繳交方式

請提交以下內容：

### 必繳項目
1. ✅ **應用分享連結** 或 **DSL 匯出檔案**
2. ✅ **知識庫文件**（您上傳的 FAQ 內容）
3. ✅ **測試截圖**（至少3個不同情境的對話截圖）
4. ✅ **簡短心得**（100-200字）

### 加分項目
- 📊 使用 Citation 功能的截圖
- 🎯 Rerank 設定的截圖
- 📈 知識庫檢索效果分析

---

## 💪 挑戰題（選做）

想要進一步挑戰？試試這些：

### 🌟 初階挑戰
1. **多知識庫整合**：建立 2-3 個不同主題的知識庫（如技術FAQ、商業FAQ）
2. **智能路由**：根據問題類型自動選擇對應的知識庫

### 🌟🌟 中階挑戰
1. **問題分類器**：加入「問題分類器」節點，針對不同問題類型使用不同的回覆模板
2. **滿意度收集**：對話結束時詢問滿意度評分

### 🌟🌟🌟 高階挑戰
1. **工單系統整合**：無法回答的問題自動建立工單（使用 HTTP 節點）
2. **智能推薦**：根據使用者問題推薦相關課程
3. **多輪澄清**：複雜問題時能夠連續提問收集完整資訊

---

## 🎓 學習資源

- 📖 第四章單元 1：RAG 概念
- 📖 第四章單元 2：Embedding 及 Rerank 模型說明
- 📖 第四章單元 3：傳統模式進行檔案上傳及測試
- 📖 第四章單元 5：製作Q&A問答流程
- 🎥 課程影片：知識庫建置實戰
- 💬 討論區：客服機器人開發經驗分享

---

## 🔍 常見問題

### Q：知識庫文件應該如何組織？
**A**：建議使用清晰的標題結構，問答對之間留空行，使用 Markdown 格式讓系統更容易分片。

### Q：Rerank 一定要用嗎？
**A**：不一定，但**強烈建議**使用。Rerank 可以大幅提升檢索準確度，特別是當知識庫內容較多時。

### Q：如何判斷檢索效果好不好？
**A**：測試時觀察：
1. 是否找到正確的知識片段
2. 回答是否準確
3. 是否有無關的內容混入

### Q：ChatFlow 和 Workflow 該選哪個？
**A**：
- **Chatflow**：適合簡單的問答場景，對話體驗較好
- **Workflow**：適合需要複雜邏輯判斷的情境

建議初學者先用 Chatflow。

---

**祝您順利完成作業！打造出優秀的 AI 客服機器人！** 🎉🤖
